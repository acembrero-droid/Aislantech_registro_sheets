<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AISLANTECH - Acceso Técnico</title>
    <style>
        :root { --amarillo: #eebc06; --fondo: #f4f4f4; --blanco: #ffffff; --texto: #333; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--fondo); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; color: var(--texto); }
        
        .card { background: var(--blanco); padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 400px; box-sizing: border-box; }
        h1 { color: var(--amarillo); text-align: center; margin-bottom: 25px; font-size: 28px; letter-spacing: -1px; }
        
        /* Pestañas */
        .tabs { display: flex; margin-bottom: 25px; border-bottom: 2px solid #eee; }
        .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; font-weight: bold; color: #aaa; transition: 0.3s; }
        .tab.active { color: var(--amarillo); border-bottom: 2px solid var(--amarillo); }

        /* Inputs */
        .input-group { margin-bottom: 15px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline: none; font-size: 15px; transition: border-color 0.3s; }
        input:focus { border-color: var(--amarillo); }
        
        /* Botones */
        button { width: 100%; padding: 14px; background: var(--amarillo); border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.2s; margin-top: 10px; }
        button:hover { background: #d4a705; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        
        /* Requisitos Contraseña */
        .req-box { margin: 10px 0; display: none; }
        .req { font-size: 12px; color: #999; display: flex; align-items: center; margin: 4px 0; }
        .req.valid { color: #28a745; font-weight: bold; }
        .req::before { content: "○"; margin-right: 8px; }
        .req.valid::before { content: "●"; }
        
        /* Enlaces */
        .links { text-align: center; margin-top: 20px; }
        .link { font-size: 13px; color: #666; cursor: pointer; display: block; margin-top: 10px; text-decoration: none; }
        .link:hover { color: var(--amarillo); }

        .loader { display: none; text-align: center; color: var(--amarillo); margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h1>AISLANTECH</h1>
    
    <div id="tabs-container" class="tabs">
        <div id="tab-login" class="tab active" onclick="setMode('login')">Entrar</div>
        <div id="tab-signup" class="tab" onclick="setMode('signup')">Registrarse</div>
    </div>

    <div id="form-content">
        <div id="group-user" class="input-group" style="display:none">
            <input type="text" id="username" placeholder="Nombre completo">
        </div>

        <div class="input-group">
            <input type="email" id="email" placeholder="Email corporativo">
        </div>

        <div id="group-pass" class="input-group">
            <input type="password" id="password" placeholder="Contraseña" oninput="validarPass()">
        </div>
        
        <div id="req-box" class="req-box">
            <div id="r-len" class="req">8+ caracteres</div>
            <div id="r-num" class="req">Un número</div>
            <div id="r-cap" class="req">Una mayúscula</div>
        </div>

        <button id="btn-submit" onclick="enviar()">Entrar</button>
        <div id="loading" class="loader">Procesando solicitud...</div>

        <div class="links">
            <span id="link-recover" class="link" onclick="setMode('recover')">¿Olvidaste tu contraseña?</span>
            <span id="link-back" class="link" style="display:none" onclick="setMode('login')">Volver al inicio</span>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // CONFIGURACIÓN: CAMBIA ESTO POR TU URL /EXEC
    const API_URL = "https://script.google.com/macros/s/AKfycbwOT8K89aveRsOaIo7NEcSxkP_xDYzEQpaEnf07Jih0BrO8_YA5D0jdy4lrtfKpgcSE/exec"; 
    // ==========================================

    let modo = 'login';

    function setMode(m) {
        modo = m;
        const isLogin = modo === 'login';
        const isSignup = modo === 'signup';
        const isRecover = modo === 'recover';

        // UI de Pestañas
        document.getElementById('tabs-container').style.display = isRecover ? 'none' : 'flex';
        document.getElementById('tab-login').classList.toggle('active', isLogin);
        document.getElementById('tab-signup').classList.toggle('active', isSignup);
        
        // Campos
        document.getElementById('group-user').style.display = isSignup ? 'block' : 'none';
        document.getElementById('group-pass').style.display = isRecover ? 'none' : 'block';
        document.getElementById('req-box').style.display = isSignup ? 'block' : 'none';
        
        // Botones y Enlaces
        document.getElementById('btn-submit').innerText = isLogin ? 'Entrar' : (isSignup ? 'Crear Cuenta' : 'Enviar Enlace de Recuperación');
        document.getElementById('link-recover').style.display = isLogin ? 'block' : 'none';
        document.getElementById('link-back').style.display = isRecover ? 'block' : 'none';
        
        validarPass();
    }

    function validarPass() {
        if (modo !== 'signup') {
            document.getElementById('btn-submit').disabled = false;
            return;
        }
        const p = document.getElementById('password').value;
        const c1 = p.length >= 8, c2 = /[0-9]/.test(p), c3 = /[A-Z]/.test(p);
        
        document.getElementById('r-len').className = c1 ? 'req valid' : 'req';
        document.getElementById('r-num').className = c2 ? 'req valid' : 'req';
        document.getElementById('r-cap').className = c3 ? 'req valid' : 'req';
        
        document.getElementById('btn-submit').disabled = !(c1 && c2 && c3);
    }

    async function enviar() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        const user = document.getElementById('username').value;

        if (!email || (modo !== 'recover' && !pass) || (modo === 'signup' && !user)) {
            alert("Por favor, completa los campos requeridos.");
            return;
        }

        const btn = document.getElementById('btn-submit');
        const loader = document.getElementById('loading');
        btn.style.display = 'none';
        loader.style.display = 'block';

        const datos = {
            action: modo,
            email: email,
            password: pass,
            username: user || "Usuario"
        };

        try {
            // Envío a Google Sheets (no-cors para evitar errores de red)
            await fetch(API_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(datos)
            });

            // Respuesta visual según el modo
            setTimeout(() => {
                loader.style.display = 'none';
                btn.style.display = 'block';

                if (modo === 'signup') {
                    alert("✓ Solicitud enviada. Si el correo es nuevo, recibirás un link de activación. Si ya existía, recibirás un aviso por email.");
                    location.reload();
                } else if (modo === 'recover') {
                    alert("✓ Si el correo está registrado, recibirás un link para cambiar tu contraseña en unos minutos.");
                    setMode('login');
                } else {
                    // LOGIN: Redirigir al Dashboard pasando el nombre de usuario
                    const nombreUsuario = user || email.split('@')[0];
                    window.location.href = "dashboard.html?user=" + encodeURIComponent(nombreUsuario);
                }
            }, 1000);

        } catch (e) {
            alert("Error de conexión con el servidor.");
            btn.style.display = 'block';
            loader.style.display = 'none';
        }
    }
</script>

</body>
</html>
